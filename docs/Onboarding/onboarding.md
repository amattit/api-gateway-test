# Онбординг
**Цель:** Собрать у пользователя предпочтения для формирования музыкальных рекомендаций.
Важно понимать, каким образом будет реализовываться переход к онбордингу пользователя. Можно использовать разные способы. Например, отображать баннер на экране, или сразу при регистрации вести пользователя в сценарий онбординга. 
:::tip[Помни]

Возможно пользователь уже проходил онбординг и ему не требуется проходить онбординг повторно!

:::

## Описание процесса

1. **Инициация онбординга**
   
   Выполните запрос для проверки [статуса онбординга](http://localhost:3000/api#tag/onboarding/GET/api/onboarding/v1/status)
   Если в ответ возвращается параметр `need_onboarding = true` отобразите баннер или используйте свои механики для привлечения пользователя к онбордингу. Можно использовать мотивационную надпись, например **"Скажите, что вам нравится"**.

2. **Экран онбординга**
   - **Пример UI:** ![Картинка](/img/onboarding/onboarding1.png)
   - **Элементы экрана:**
     - Заголовок.
     - Строка поиска.
     - Бесконечная сетка из 3 артистов в ряд.
     - Возможность выбора артистов.

    Для того, чтобы заполнить экран с артистами используйте [вызов сервиса](http://localhost:3000/api#tag/onboarding/GET/api/onboarding/v1/artists)
:::tip[Внимание!]

**Порядок выдачи:** ответ отсортирован по наиболее популярным артистам из популярных кластеров.

:::

    Рекомендуем в качестве параметра `limit` выставлять число 15 (максимум 25). При скролле вниз до самого конца подгружать очередную страницу.

:::danger[Внимание!]

В ответе сервиса не возвращаются ссылки на изображения артистов. для того, чтобы отобразить обложки артистов используйте вызов [сервиса получения ссылок на изображения артиста](http://localhost:3000/api#tag/onboarding/GET/api/onboarding/v1/artists). В ответ прилетят ссылки на CDN с картинками, которые надо будет подставлять в UI.

:::

:::tip[Внимание!]

Для формирования персональных рекомендаций необходимо выбрать **не менее 5 артистов**.

:::


3. **Выбор артистов**

Выбор артиста осуществляется по тапу на аватаре. Выделите визуально выбранного артиста:
     - На аватаре отображается галочка на полупрозрачном фоне с градиентной заливкой.
     - Цвет заливки зависит от акцентного цвета темы приложения.
     - Выбор снимается повторным тапом.
   - **UI:** ![Картинка](/img/onboarding/onboarding-select.png)

:::tip[Внимание!]

При выборе артиста сохраняйте его `id` в локальной памяти устройства на котором происходит онбординг.

:::

При тапе на артиста рекомендуем вызвать [сервис поиска похожих артистов](http://localhost:3000/api#tag/onboarding/GET/api/onboarding/v1/artists/{artist_id}/similar), при этом:
    - Сетка онбординга обновляется, выбранный артист ставится на первую позицию и выделяется галочкой. 
    - Следом за выбранным артистом необходимо добавить результат ответа вызова [сервиса поиска похожих артистов](http://localhost:3000/api#tag/onboarding/GET/api/onboarding/v1/artists/{artist_id}/similar), не забыв запросить по ним ссылки на обложки артистов.
    - Тап на выбранном артисте снимает выбор, но не перестраивает сетку.

4. **Прогрессбар**

Рекомендуется выводить прогрес онбординга:
   - Количество выбранных артистов отображается в прогрессбаре.
   ![Картинка](/img/onboarding/onboarding-progress.png)
   - Прогрессбар окрашивается градиентом акцентных цветов.
   - После выбора 5 артистов отображается кнопка **"Продолжить"**.
   ![Картинка](/img/onboarding/onboarding-finish.png)
   - Если пользователь перезагрузил страницу/экран, не нажав кнопку, выбор сбрасывается и кнопка **"Продолжить"** должна быть недоступна.

5. **Поиск артистов**

Общие рекомендации по поиску
   - Строка поиска работает аналогично поиску в приложении.
   - При прокрутке строка поиска прилипает к верхней части экрана.
   - **По тапу на строке поиска:**
     - Экран затемняется.
     - Раскрывается клавиатура.
     - Строка поиска переводится в активное состояние, чтобы можно было сразу вводить текст.
     - Справа отображается кнопка **"Отмена"**.
   - **Результаты поиска:**
     - При вводе символов выполняйте поиск вызвав [сервис поиска](http://localhost:3000/api#tag/onboarding/GET/api/onboarding/v1/artists/search).
     - Результаты отображаются в виде списка с аватаром и именем артиста.
     - По умолчанию рекомендуем показывать первые 3 результата и кнопка **"Еще"**.
     - При нажатии на **"Еще"** список раскрывается на весь экран.
   - **Приоритет выдачи в поиске:**
     - Артисты по полному соответствию запросу.
     - Артисты по неполному соответствию, начиная с наиболее популярных.
     - Артисты, похожие на уже выбранных.
   - **Отмена поиска:**
     - При нажатии на **"Отмена"** запрос стирается, клавиатура убирается, затемнение экрана исчезает, и отображается исходная сетка артистов.
   - При тапе на артиста в поисковой выдаче:
     - Строка поиска очищается.
     - Клавиатура убирается.
     - Сетка онбординга обновляется, выбранный артист ставится на первую позицию и выделяется галочкой.
   - Тап на выбранном артисте снимает выбор, но не перестраивает сетку.

   6. **Завершение онбординга**
    - Нажимая на кнопку **"Продолжить"** выполните вызов [сервиса завершения онбординга](http://localhost:3000/api#tag/onboarding/POST/api/onboarding/v1/apply) передав в качестве аргумента массив из выбранных пользователем `id` артистов

    После этого данные по пользователю отправляются в рекомендательную систему. Пользователь может слушать [персональную волну](http://localhost:3000/docs/PersonalWave/)